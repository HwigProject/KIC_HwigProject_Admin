<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.hwig.admin.mappers.memberMapper">

	<insert id="memberInsert">
		insert into tbl_member (mem_id, mem_pw, mem_tel, mem_name, mem_addr, mem_email, mem_regdate)
			values (#{mem_id}, #{mem_pw}, #{mem_tel}, #{mem_name}, #{mem_addr}, #{mem_email}, sysdate)
	</insert>
	
	<sql id="search">
		<if test="searchType != null">
			<if test="searchType == 'id'.toString()">
				and mem_id like '%' || #{keyword} || '%'
			</if>
			<if test="searchType == 'name'.toString()">
				and mem_name like '%' || #{keyword} || '%'
			</if>
		</if>
	</sql>
	
	<select id="memberAllSelect" resultType="MemberVO">
		select * from (
			select mem_id, mem_pw, mem_tel, mem_name, mem_addr,
			mem_email, to_char(mem_regdate,'YYYY-MM-DD')as mem_regdate, mem_grade, mem_reverse,
				row_number() over(order by mem_regdate desc) as rnum from tbl_member where 1=1
		
		<include  refid="search"></include>
		
			) mb where rnum between #{pageStart} and #{pageEnd}
	</select>
	
	<select id="memberAllCount" resultType="int">
		select count(mem_id) from tbl_member where 1=1
		<include  refid="search"></include>
	</select>
	
	<!-- 회원정보상세, 로그인시 사용 -->
	<select id="memberSelect" resultType="MemberVO">
		select * from tbl_member where mem_id = #{mem_id}
		<if test="mem_pw != null and mem_pw != ''">
			and mem_pw = #{mem_pw}
		</if>
	</select>
	
	<!-- 이메일 체크시 사용 -->
	<select id="emailCheck" resultType="int">
		select count(*) from tbl_member where mem_email = #{mem_email}
	</select>
	
	<!-- 아이디 체크시 사용 -->
	<select id="idCheck" resultType="int">
		select count(*) from tbl_member where mem_id = #{mem_id}
	</select>
	
	<!-- 회원정보수정전 아이디, 비밀번호 체크 -->
	<select id="isRightUserCheck" resultType="int">
		select count(*) from tbl_member where mem_id = #{mem_id} and mem_pw = #{mem_pw}
	</select>
	
	<!-- 회원정보수정 -->
	<update id="memberUpdate">
		update tbl_member set
			mem_tel = #{mem_tel}, mem_addr = #{mem_addr}, mem_email = #{mem_email}
			<if test="mem_newpw != null and mem_newpw != ''">
				,mem_pw = #{mem_newpw}
			</if>
				where mem_id = #{mem_id} and mem_pw = #{mem_pw}
	</update>
	
	<!-- 회원탈퇴 -->
	<delete id="memberDelete">
		delete from tbl_member where mem_id = #{mem_id}
	</delete>

</mapper>